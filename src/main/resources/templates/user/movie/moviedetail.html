<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" class=" sizes customelements history pointerevents postmessage webgl websockets cssanimations csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox picture srcset webworkers">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- Thymeleaf links for static resources -->
   <link rel="stylesheet" th:href="@{/css/all.min.css}" />
    <link rel="stylesheet" th:href="@{/css/animate.css}" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" th:href="@{/css/css.css}" />
    <link rel="stylesheet" th:href="@{/css/flaticon.css}" />
    <link rel="stylesheet" th:href="@{/css/fontawesome.min.css}" />
    <link rel="stylesheet" th:href="@{/css/magnific-popup.css}" />
    <link rel="stylesheet" th:href="@{/css/main.css}" />
    <link rel="stylesheet" th:href="@{/css/nice-select.css}" />
    <link rel="stylesheet" th:href="@{/css/odometer.css}" />
    <link rel="stylesheet" th:href="@{/css/owl.carousel.min.css}" />
    <link rel="stylesheet" th:href="@{/css/owl.theme.default.min.css}" />
    <link rel="shortcut icon" th:href="@{/images/favicon.png}" type="image/x-icon">

    <link rel="shortcut icon" th:href="@{/assets/images/favicon.png}" type="image/x-icon">
    
    <script th:src="@{/js/movielistjs/jquery-3.3.1.min.js}"></script>

	<style>
		.header-button.pr-0 { display: flex; align-items: center; }
         .header-user-greeting { color: #ccc; margin-right: 15px; font-size: 0.9em; }
         .header-user-greeting b { color: #fff; font-weight: 600; }
         .logout-button-form { display: inline-block; margin: 0; padding: 0; vertical-align: middle; }
         .logout-button-styled {
            background: linear-gradient(to right, #e1457a, #8f5ff3); color: #ffffff; padding: 10px 25px; border-radius: 50px; text-transform: uppercase; font-weight: 700; font-size: 14px; letter-spacing: 1px; text-decoration: none; display: inline-block; transition: all 0.3s ease; border: none; cursor: pointer; line-height: normal; text-align: center; vertical-align: middle; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
         }
         .logout-button-styled:hover { opacity: 0.9; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25); transform: translateY(-1px); }
		
	</style>
    <!-- Dynamic page title -->
    <title th:text="${movie != null ? movie.title + ' - Movie Details' : 'Boleto - Movie Details'}">Boleto - Online Ticket Booking Website HTML Template</title>

</head>

<body>
    <!-- ==========Preloader========== -->
    <div class="preloader" style="display: none;">
        <div class="preloader-inner">
            <div class="preloader-icon">
                <span></span>
                <span></span>
            </div>
        </div>
    </div>
    <!-- ==========Preloader========== -->
    <!-- ==========Overlay========== -->
    <div class="overlay"></div>
    <a href="#0" class="scrollToTop"> <!-- Keep href="#0" for JS functionality -->
        <i class="fas fa-angle-up"></i>
    </a>
    <!-- ==========Overlay========== -->

       <!-- ==========Header-Section========== -->
    <header class="header-section">
        <div class="container">
            <div class="header-wrapper">
                <div class="logo">
                    <a th:href="@{/}">
                        <img th:src="@{/images/logo.png}" alt="logo"> 
                    </a>
                </div>
                <ul class="menu">
                     <li class="menu-item-has-children" >
                        <a th:href="@{/home}" th:classappend="${requestURI != null and #strings.startsWith(requestURI, '/home')} ? 'active' : ''">Home</a>                   
                    </li>
                    <li class="menu-item-has-children">
                        <a th:href="@{/movielist}" th:classappend="${requestURI != null and #strings.startsWith(requestURI, '/movies')} ? 'active' : ''">movies</a>
                        <ul class="submenu"> 
                            <li><a th:href="@{/movielist}" th:classappend="${requestURI != null and #strings.equals(requestURI, '/movielist')} ? 'active' : ''">Movie List</a></li>
                            <li><a th:href="@{/movielist}">Movie Details</a></li>  
                            <li><a th:href="@{/movielist}">Movie Ticket Plan</a></li>
                            <li><a th:href="@{/movielist}">Movie Seat Plan</a></li>
                            <li><a th:href="@{/movielist}">Movie Checkout</a></li>
                            
                        </ul>
                    </li>
                
                     
                      <li class="menu-item-has-children">
                         <a href="#">pages</a>
                         <ul class="submenu">
                             <li><a th:href="@{/about}">About Us</a></li>
                             <li><a th:href="@{/apps-download}">Apps Download</a></li>
                             <li><a th:href="@{/sign-in}">Sign In</a></li>
                             <li><a th:href="@{/sign-up}">Sign Up</a></li>
                             <li><a th:href="@{/404}">404</a></li>
                         </ul>
                     </li>
	                     <!-- Hiển thị lời chào nếu đã đăng nhập -->
	                <li class="menu-item" sec:authorize="isAuthenticated()">
	                    <a href="#">Xin chào, <span sec:authentication="name"></span>!</a>
	                </li>
	 
	                <!-- Nút Logout nếu đã đăng nhập -->
	                <li class="header-button pr-0" sec:authorize="isAuthenticated()">
					    <form class="logout-button-form" th:action="@{/logout}" method="post">
						    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						    <button class="logout-button-styled" type="submit">LOG OUT</button>
						</form>
					</li>                      
                              
                </ul>
                <div class="header-bar d-lg-none">
					<span></span>
					<span></span>
					<span></span>
				</div>
            </div>
        </div>
    </header>
    <!-- ==========Header-Section========== -->
    
    <!-- ==========Banner-Section========== -->
    <!-- Use dynamic background image from movie.bannerUrl -->
    <section class="details-banner bg_img"
             th:style="${movie != null and movie.bannerUrl != null} ? 'background-image: url(' + @{${movie.bannerUrl}} + ');' : 'background-image: url(' + @{/banner03.jpg} + ');'"
             th:attr="data-background=${movie != null and movie.bannerUrl != null ? movie.bannerUrl : './assets/images/banner/banner03.jpg'}">
        <div class="container">
            <!-- Only render if movie object exists -->
            <div class="details-banner-wrapper" th:if="${movie != null}">
                <div class="details-banner-thumb">
                    <!-- Dynamic poster image -->
                    <img th:src="${movie.posterUrl != null ? movie.posterUrl : '/images/placeholder.jpg'}" alt="movie poster">
                    <!-- Dynamic trailer link -->
                    <a th:href="${movie.trailerUrl}" class="video-popup" target="_blank">
                        <img th:src="@{/images/video-button.png}" alt="play trailer">
                    </a>
                </div>
                <div class="details-banner-content offset-lg-3">
                    <!-- Dynamic title -->
                    <h3 class="title" th:text="${movie.title}">Movie Title</h3>
                    <div class="tags">
                        <!-- Dynamic language -->
                        <a href="#0" th:text="${movie.language}">Language</a>
                        <!-- Add more tags if needed, e.g., from availableFormats -->
                         <!-- <a href="#0" th:each="format : ${movie.availableFormats}" th:text="${format}">Format</a> -->
                    </div>
                    <!-- Dynamic primary genre -->
					<div class="detail-item">
					    <h5 class="sub-title">Genres</h5>
					    <p th:if="${movie.genres != null and !#strings.isEmpty(movie.genres)}">
					        <th:block th:each="genreName, iterStat : ${#strings.arraySplit(movie.genres, ',')}">
					            <span th:text="${#strings.trim(genreName)}">Genre</span><th:if="${not iterStat.last}">, </th:if>
					        </th:block>
					    </p>
					    <p th:unless="${movie.genres != null and !#strings.isEmpty(movie.genres)}">N/A</p>
					</div>

					<div class="detail-item">
					    <h5 class="sub-title">Available Formats</h5>
					    <th:block th:if="${movie.availableFormats != null and !#strings.isEmpty(movie.availableFormats)}">
					        <p>
					            <span th:each="formatName, iterStat : ${#strings.arraySplit(movie.availableFormats, ',')}">
					                <span th:text="${#strings.trim(formatName)}">Format</span><th:if="${not iterStat.last}">, </th:if>
					            </span>
					        </p>
					    </th:block>
					    <span th:unless="${movie.availableFormats != null and !#strings.isEmpty(movie.availableFormats)}">N/A</span>
					</div>

                    <div class="social-and-duration">
                        <div class="duration-area">
                            <div class="item">
                                <i class="fas fa-calendar-alt"></i>
                                <!-- Dynamic release date formatted -->
                                <span th:if="${movie.releaseDate != null}" th:text="${#temporals.format(movie.releaseDate, 'dd MMM, yyyy')}">Release Date</span>
                            </div>
                            <div class="item">
                                <i class="far fa-clock"></i>
                                <!-- Dynamic duration (needs formatting) -->
                                <!-- TODO: Format duration nicely (e.g., '2h 50m') in Service/Entity -->
                                <span th:text="${movie.duration != null ? movie.duration + ' mins' : 'N/A'}">Duration</span>
                            </div>
                        </div>
                        <!-- Social share links (keep static or make dynamic if needed) -->
                        <ul class="social-share">
                            <li><a href="#0"><i class="fab fa-facebook-f"></i></a></li>
                            <li><a href="#0"><i class="fab fa-twitter"></i></a></li>
                            <li><a href="#0"><i class="fab fa-pinterest-p"></i></a></li>
                            <li><a href="#0"><i class="fab fa-linkedin-in"></i></a></li>
                            <li><a href="#0"><i class="fab fa-google-plus-g"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Fallback if movie is not found -->
            <div class="details-banner-wrapper" th:unless="${movie != null}">
                 <h3 style="color: white; text-align: center; padding: 50px;">Movie Not Found!</h3>
            </div>
        </div>
    </section>
    <!-- ==========Banner-Section========== -->

    <!-- ==========Book-Section========== -->
    <section class="book-section bg-one" th:if="${movie != null}">
        <div class="container">
            <div class="book-wrapper offset-lg-3">
                <div class="left-side">
                    <!-- Tomatometer/Audience Score - Keep static or use different fields if available -->
                    <div class="item">
                        <div class="item-header">
                            <div class="thumb"><img th:src="@{/images/tomato2.png}" alt="rating icon"></div>
                            <div class="counter-area"><span class="counter-item odometer odometer-auto-theme" data-odometer-final="88">88</span></div>
                        </div>
                        <p>tomatometer</p>
                    </div>
                    <div class="item">
                        <div class="item-header">
                            <div class="thumb"><img th:src="@{/images/cake2.png}" alt="rating icon"></div>
                            <div class="counter-area"><span class="counter-item odometer odometer-auto-theme" data-odometer-final="88">88</span></div>
                        </div>
                        <p>audience Score</p>
                    </div>
                    <!-- User Rating -->
                    <div class="item">
                        <div class="item-header">
                            <h5 class="title" th:text="${movie.rating != null ? #numbers.formatDecimal(movie.rating, 1, 1) : 'N/A'}">4.5</h5>
                            <div class="rated">
                                <!-- TODO: Implement dynamic star display based on movie.rating -->
                                <i class="fas fa-heart"></i>
                                <i class="fas fa-heart"></i>
                                <i class="fas fa-heart"></i>
                                <i class="fas fa-heart"></i>
                                <i class="fas fa-heart"></i>
                            </div>
                        </div>
                        <p>Users Rating</p>
                    </div>
                    <!-- Rate It section (User interaction) -->
                    <div class="item">
                        <div class="item-header">
                            <div class="rated rate-it"> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> </div>
                            <h5 class="title">0.0</h5>
                        </div>
                        <p><a href="#0">Rate It</a></p>
                    </div>
                </div>
                <!-- Dynamic book tickets link -->
                <a th:href="@{/movies/{movieId}/showtimes(movieId=${movie.id})}" class="custom-button">book tickets</a>
            </div>
        </div>
    </section>
    <!-- ==========Book-Section========== -->

    <!-- ==========Movie-Section========== -->
    <section class="movie-details-section padding-top padding-bottom" th:if="${movie != null}">
        <div class="container">
            <div class="row justify-content-center flex-wrap-reverse mb--50">
                <!-- Sidebar -->
                <div class="col-lg-3 col-sm-10 col-md-6 mb-50">
                    <!-- Available Formats -->
                    <div class="detail-item">
					    <h5 class="sub-title">Available Formats</h5>
					    <p th:text="${movie.availableFormats} ?: 'N/A'"></p>
					</div>

                    <!-- !!! OFFER WIDGET REMOVED HERE !!! -->

                    <!-- Static Banner Widget -->
                    <div class="widget-1 widget-banner">
                        <div class="widget-1-body">
                            <a href="#0">
                                <img th:src="@{/images/banner01.jpg}" alt="banner">
                            </a>
                        </div>
                    </div>
                </div>
                <!-- Main Content -->
                <div class="col-lg-9 mb-50">
                    <div class="movie-details">
                        <!-- Photos Carousel -->
                        <h3 class="title">photos</h3>
                        <div class="details-photos owl-carousel owl-loaded owl-drag">
                            <div class="owl-stage-outer"><div class="owl-stage">
                                <!-- Loop through photoUrls -->
                                <div class="owl-item" style="width: 262.5px; margin-right: 30px;" th:each="photoUrl : ${movie.photoUrls}">
                                    <div class="thumb">
                                        <a th:href="${photoUrl}" class="img-pop">
                                            <img th:src="${photoUrl}" alt="movie photo">
                                        </a>
                                    </div>
                                </div>
                                <!-- Fallback if no photos -->
                                <div class="owl-item" style="width: 262.5px; margin-right: 30px;" th:if="${#lists.isEmpty(movie.photoUrls)}">
                                     <div class="thumb"><img th:src="@{/images/movie-details01.jpg}" alt="movie photo placeholder"></div>
                                </div>
                            </div></div>
                            <div class="owl-nav disabled"><button type="button" role="presentation" class="owl-prev"><span aria-label="Previous">‹</span></button><button type="button" role="presentation" class="owl-next"><span aria-label="Next">›</span></button></div><div class="owl-dots disabled"></div>
                        </div>

                        <!-- Summary and Review Tabs -->
                        <div class="tab summery-review">
                            <ul class="tab-menu">
                                <li class="active"> summery </li>
                                <li> user review <span th:text="${reviewPage != null ? reviewPage.totalElements : 0}">0</span> </li>
                            </ul>
                            <div class="tab-area">
                                <!-- Summary Tab -->
                                <div class="tab-item active">
                                    <!-- Synopsis -->
                                    <div class="item">
                                        <h5 class="sub-title">Synopsis</h5>
                                        <p th:text="${movie.description}">Movie description goes here.</p>
                                    </div>
                                    <!-- Cast Slider -->
                                    <div class="item">
                                        <div class="header">
                                            <h5 class="sub-title">cast</h5>
                                            <div class="navigation">
                                                <div class="cast-prev"><i class="flaticon-double-right-arrows-angles"></i></div>
                                                <div class="cast-next"><i class="flaticon-double-right-arrows-angles"></i></div>
                                            </div>
                                        </div>
                                        <div class="casting-slider owl-carousel owl-loaded owl-drag">
                                            <div class="owl-stage-outer"><div class="owl-stage">
                                                <th:block th:if="${movie.cast != null and !#strings.isEmpty(movie.cast)}">
												    <div class="owl-item" th:each="actorName : ${#strings.arraySplit(movie.cast, ',')}">
												        <div class="cast-item">
												            <div class="cast-thumb">
												                <a href="javascript:void(0);"><img th:src="@{/images/cast-placeholder.jpg}" alt="cast photo"></a>
												            </div>
												            <div class="cast-content">
												                <h6 class="cast-title"><a href="javascript:void(0);" th:text="${#strings.trim(actorName)}">Actor Name</a></h6>
												                <span class="cate">actor</span>
												            </div>
												        </div>
												    </div>
												</th:block>
												<div class="owl-item" th:if="${movie.cast == null or #strings.isEmpty(movie.cast)}">
												    <p style="padding: 20px; text-align: center;">No cast information available.</p>
												</div>
                                            </div></div>
                                            <div class="owl-nav disabled"><button type="button" role="presentation" class="owl-prev"><span aria-label="Previous">‹</span></button><button type="button" role="presentation" class="owl-next"><span aria-label="Next">›</span></button></div><div class="owl-dots disabled"></div>
                                        </div>
                                    </div>
                                    <!-- Crew Slider -->
                                    <div class="item">
                                        <div class="header">
                                            <h5 class="sub-title">crew</h5>
                                            <div class="navigation">
                                                <div class="cast-prev-2"><i class="flaticon-double-right-arrows-angles"></i></div>
                                                <div class="cast-next-2"><i class="flaticon-double-right-arrows-angles"></i></div>
                                            </div>
                                        </div>
                                        <div class="casting-slider-two owl-carousel owl-loaded owl-drag">
                                            <div class="owl-stage-outer"><div class="owl-stage">
                                                <!-- Loop through movieCrews -->
                                                <div class="owl-item" style="width: 136.875px; margin-right: 100px;" th:each="movieCrew : ${movie.movieCrews}">
                                                    <div class="cast-item">
                                                        <div class="cast-thumb">
                                                            <a th:href="@{/crew/{id}(id=${movieCrew.crewMember.id})}">
                                                                <img th:src="${movieCrew.crewMember.imageUrl != null ? movieCrew.crewMember.imageUrl : '/images/crew-placeholder.jpg'}" alt="crew photo">
                                                            </a>
                                                        </div>
                                                        <div class="cast-content">
                                                            <h6 class="cast-title">
                                                                <a th:href="@{/crew/{id}(id=${movieCrew.crewMember.id})}" th:text="${movieCrew.crewMember.name}">Crew Name</a>
                                                            </h6>
                                                            <span class="cate" th:text="${movieCrew.jobTitle}">Job Title</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                 <!-- Fallback if no crew -->
                                                <div class="owl-item" th:if="${#lists.isEmpty(movie.movieCrews)}">
                                                     <p>No crew information available.</p>
                                                </div>
                                            </div></div>
                                            <div class="owl-nav disabled"><button type="button" role="presentation" class="owl-prev"><span aria-label="Previous">‹</span></button><button type="button" role="presentation" class="owl-next"><span aria-label="Next">›</span></button></div><div class="owl-dots disabled"></div>
                                        </div>
                                    </div>
                                </div>
                                <!-- User Review Tab -->
			                    <div class="tab-item">
							    <!-- Kiểm tra xem movie có tồn tại không (đề phòng) -->
							    <div th:if="${movie != null}">
							
							        <!-- Loop through reviews using the new list for the initial page -->
							        <!-- Thay đổi: Sử dụng reviewsForDisplay thay vì movie.reviews -->
							        <div class="movie-review-item" th:each="review : ${reviewsForDisplay}">
							            <div class="author">
							                <div class="thumb">
							                    <!-- Sử dụng safe navigation (?.) để tránh lỗi nếu user null -->
							                    <a href="#0">
							                        <img th:src="${review.user?.avatarUrl != null ? review.user.avatarUrl : '/images/user-placeholder.jpg'}" alt="user avatar">
							                    </a>
							                </div>
							                <div class="movie-review-info">
							                    <span class="reply-date" th:if="${review.timestamp != null}" th:text="${#temporals.format(review.timestamp, 'dd MMM yyyy HH:mm')}">Review Date</span>
							                    <!-- Sử dụng safe navigation (?.) -->
							                    <h6 class="subtitle"><a href="#0" th:text="${review.user?.fullname != null ? review.user.fullname : review.user?.username}">User Name</a></h6>
							                    <span th:if="${review.verified != null and review.verified}"><i class="fas fa-check"></i> verified review</span>
							                </div>
							            </div>
							            <div class="movie-review-content">
							                <div class="review">
							                    <!-- Xử lý rating null -->
							                    <i class="flaticon-favorite-heart-button" th:each="star : ${#numbers.sequence(1, review.rating != null ? review.rating : 0)}"></i>
							                    <!-- (Tùy chọn) Hiển thị sao rỗng nếu cần -->
							                    <!-- <i class="far fa-star" th:each="star : ${#numbers.sequence(1, 5 - (review.rating != null ? review.rating : 0))}" style="color: #ccc;"></i> -->
							                </div>
							                <h6 class="cont-title" th:text="${review.title}">Review Title</h6>
							                <p th:text="${review.content}">Review content...</p>
							                <div class="review-meta">
							                    <!-- Xử lý likes/dislikes null -->
							                    <a href="#0"> <i class="flaticon-hand"></i><span th:text="${review.likes != null ? review.likes : 0}">0</span> </a>
							                    <a href="#0" class="dislike"> <i class="flaticon-dont-like-symbol"></i><span th:text="${review.dislikes != null ? review.dislikes : 0}">0</span> </a>
							                    <a href="#0"> Report Abuse </a>
							                </div>
							            </div>
							        </div>
							
							        <!-- Fallback if no reviews FOR THIS INITIAL PAGE -->
							        <!-- Thay đổi: Kiểm tra reviewsForDisplay -->
							        <!-- Thêm ID để JavaScript có thể ẩn/hiện nếu cần -->
							        <div id="no-reviews-message" class="movie-review-item" th:if="${#lists.isEmpty(reviewsForDisplay)}">
							            <p>No reviews yet.</p>
							        </div>
							
							        <!-- Container để JavaScript thêm các review tải sau vào đây -->
							        <div id="more-reviews-container"></div>
							
							        <!-- Load more button -->
							        <!-- Thay đổi: Điều kiện dựa vào reviewPage.hasNext() -->
							        <!-- Thêm ID và data attributes để JavaScript sử dụng -->
							        <div class="load-more text-center" th:if="${reviewPage != null and reviewPage.hasNext()}">
							            <a href="javascript:void(0);" class="custom-button transparent"
							               id="load-more-reviews-btn"
							               th:attr="data-movie-id=${movie.id}, data-next-page=${reviewPage.number + 1}, data-page-size=${reviewPage.size}">
							                load more
							            </a>
							        </div>
							
							    </div> <!-- end th:if="${movie != null}" -->
							
							    <!-- Fallback nếu đối tượng movie không tồn tại -->
							    <div th:if="${movie == null}">
							        <p>Movie information not available.</p>
							    </div>
							    <div id="reviews-section" class="leave-review-section mt-5 pt-4 border-top" th:if="${movie != null}"> <!-- Thêm id để có thể cuộn tới -->
							        <!-- Chỉ hiển thị form nếu người dùng đã đăng nhập -->
							        <div th:if="${#authorization.expression('isAuthenticated()')}">
							            <h4>Leave a Review for <span th:text="${movie.title}">Movie Title</span></h4>
							
							            <!-- Thông báo thành công/lỗi khi gửi review (từ RedirectAttributes) -->
							            <div th:if="${param.reviewSuccess}" class="alert alert-success" role="alert"
							                 th:text="${param.reviewSuccess[0] == 'true' ? 'Your review has been submitted successfully!' : ''}">
							            </div>
							            <div th:if="${param.reviewError}" class="alert alert-danger" role="alert"
							                 th:text="${param.reviewError[0]}">
							            </div>
							            <!-- Hoặc dùng các biến flash attribute trực tiếp nếu bạn đặt tên khác -->
							            <div th:if="${reviewSuccessMessage}" class="alert alert-success" role="alert" th:text="${reviewSuccessMessage}"></div>
							            <div th:if="${reviewErrorMessage}" class="alert alert-danger" role="alert" th:text="${reviewErrorMessage}"></div>
							
							
							            <form id="reviewForm" th:action="@{/movies/{movieId}/reviews/submit(movieId=${movie.id})}" method="post" class="comment-form mt-3">
							                <!-- Trường movieId đã có trong URL action, không cần input hidden nữa nếu URL đúng -->
							
							                <div class="form-group row">
							                    <label for="rating" class="col-sm-3 col-form-label">Your Rating <span class="text-danger">*</span>:</label>
							                    <div class="col-sm-9">
							                        <!-- Ví dụ dùng select, bạn có thể làm đẹp hơn bằng JS (Star Rating Component) -->
							                        <select class="form-control" id="rating" name="rating" required>
							                            <option value="" disabled selected>-- Select Rating --</option>
							                            <option value="5">★★★★★ (Excellent)</option>
							                            <option value="4">★★★★☆ (Good)</option>
							                            <option value="3">★★★☆☆ (Average)</option>
							                            <option value="2">★★☆☆☆ (Fair)</option>
							                            <option value="1">★☆☆☆☆ (Poor)</option>
							                        </select>
							                    </div>
							                </div>
							
							                <div class="form-group row">
							                    <label for="reviewTitle" class="col-sm-3 col-form-label">Review Title:</label>
							                    <div class="col-sm-9">
							                        <input type="text" class="form-control" id="reviewTitle" name="title" placeholder="e.g., Amazing movie!"
							                               th:value="${submittedTitle}"> <!-- Giữ lại giá trị nếu có lỗi server-side validation -->
							                    </div>
							                </div>
							
							                <div class="form-group row">
							                    <label for="reviewContent" class="col-sm-3 col-form-label">Your Review <span class="text-danger">*</span>:</label>
							                    <div class="col-sm-9">
							                        <textarea class="form-control" id="reviewContent" name="content" rows="5" placeholder="Share your thoughts..." required
							                                  th:text="${submittedContent}"></textarea> <!-- Giữ lại giá trị -->
							                    </div>
							                </div>
							
							                <div class="form-group row">
							                    <div class="col-sm-9 offset-sm-3">
							                        <button type="submit" class="custom-button btn-primary">Submit Review</button>
							                    </div>
							                </div>
							            </form>
							        </div>
							
							        <!-- Thông báo nếu người dùng chưa đăng nhập -->
							        <div th:unless="${#authorization.expression('isAuthenticated()')}" class="text-center">
							            <p class="lead">Want to share your thoughts on this movie?</p>
							            <a th:href="@{/login(redirectUrl=${#httpServletRequest.requestURI})}" class="custom-button">Login to Write a Review</a>
							            <!-- (redirectUrl là tùy chọn, để đưa người dùng quay lại sau khi login) -->
							        </div>
							    </div> <!-- end .leave-review-section -->
							
							</div> <!-- end .tab-item -->

									
							    
							</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
       
    </section>
    <!-- ==========Movie-Section========== -->

    <!-- ==========Footer Section========== -->
    <footer class="footer-section">
        <!-- Newsletter Section -->
        <div class="newslater-section padding-bottom">
            <div class="container">
                <div class="newslater-container bg_img" th:attr="data-background=@{/assets/images/newslater/newslater-bg01.jpg}" style="background-image: url('./assets/images/newslater/newslater-bg01.jpg');">
                    <div class="newslater-wrapper">
                        <h5 class="cate">subscribe to Boleto </h5>
                        <h3 class="title">to get exclusive benifits</h3>
                        <form class="newslater-form" th:action="@{/subscribe}" method="post">
                            <input type="email" placeholder="Your Email Address" name="email" required>
                            <button type="submit">subscribe</button>
                        </form>
                        <p>We respect your privacy, so we never share your info</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Footer Content -->
        <div class="container">
            <div class="footer-top">
                <div class="logo"> <a th:href="@{/}"> <img th:src="@{/images/footer-logo.png}" alt="footer logo"> </a> </div>
                 <ul class="social-icons">
                     <li><a href="#0"><i class="fab fa-facebook-f"></i></a></li>
                     <li><a href="#0" class="active"><i class="fab fa-twitter"></i></a></li>
                     <li><a href="#0"><i class="fab fa-pinterest-p"></i></a></li>
                     <li><a href="#0"><i class="fab fa-google"></i></a></li>
                     <li><a href="#0"><i class="fab fa-instagram"></i></a></li>
                 </ul>
            </div>
            <div class="footer-bottom">
                 <div class="footer-bottom-area">
                     <div class="left"> <p>Copyright © <span th:text="${#dates.year(#dates.createNow())}">2024</span>. All Rights Reserved By <a href="#0">Boleto</a></p> </div>
                     <ul class="links">
                         <li><a th:href="@{/about}">About</a></li>
                         <li><a th:href="@{/terms}">Terms Of Use</a></li>
                         <li><a th:href="@{/privacy}">Privacy Policy</a></li>
                         <li><a th:href="@{/faq}">FAQ</a></li>
                         <li><a th:href="@{/feedback}">Feedback</a></li>
                     </ul>
                 </div>
             </div>
        </div>
    </footer>
    <!-- ==========Footer Section========== -->

  	<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
  		<script th:src="@{/js/popper.min.js}"></script>
		<script th:src="@{/js/bootstrap.min.js}"></script>
		<script th:src="@{/js/modernizr-3.6.0.min.js}"></script>

		<script th:src="@{/js/plugins.js}"></script>
	
		<script th:src="@{/js/magnific-popup.min.js}"></script>
		<script th:src="@{/js/nice-select.js}"></script>
		<script th:src="@{/js/odometer.min.js}"></script>
		<script th:src="@{/js/owl.carousel.min.js}"></script>
		<script th:src="@{/js/viewport.jquery.js}"></script>
		<script th:src="@{/js/wow.min.js}"></script>
		<script th:src="@{/js/countdown.min.js}"></script>
		<script th:src="@{/js/isotope.pkgd.min.js}"></script>
		<script th:src="@{/js/contentInt.js}"></script>
		<script th:src="@{/js/chunk-7ac80a40.js}"></script>
		<script th:src="@{/js/main.js}"></script>
		
	<script th:inline="javascript">
								/*<![CDATA[*/
						    	document.addEventListener('DOMContentLoaded', function() {
						        // --- PHẦN VALIDATE FORM REVIEW ---
						        const reviewForm = document.getElementById('reviewForm');
						        if (reviewForm) {
						            reviewForm.addEventListener('submit', function(event) {
						                const ratingSelect = document.getElementById('rating'); // Đổi tên biến cho rõ ràng
						                const contentTextarea = document.getElementById('reviewContent'); // Đổi tên biến
						                let isValid = true; // Biến cờ để theo dõi tính hợp lệ
						
						                // Xóa các thông báo lỗi cũ trước khi validate lại
						                clearErrorMessages(this); // 'this' ở đây là form
						
						                if (!ratingSelect.value) { // Kiểm tra giá trị của select
						                    isValid = false;
						                    displayErrorMessage(ratingSelect, 'Please select a rating.');
						                }
						
						                if (!contentTextarea.value.trim()) {
						                    isValid = false;
						                    displayErrorMessage(contentTextarea, 'Please write your review content.');
						                } else if (contentTextarea.value.trim().length < 10) { // Ví dụ: kiểm tra độ dài tối thiểu
						                    isValid = false;
						                    displayErrorMessage(contentTextarea, 'Review content must be at least 10 characters long.');
						                }
						                // Thêm các xác thực khác nếu cần (ví dụ: title)
						
						                if (!isValid) {
						                    event.preventDefault(); // Ngăn form gửi đi nếu không hợp lệ
						                }
						                // Nếu hợp lệ, form sẽ được submit theo cách truyền thống
						            });
						        }
						
						        // --- HÀM HELPER CHO HIỂN THỊ LỖI (như đã gợi ý ở câu trả lời trước) ---
						        function displayErrorMessage(inputElement, message) {
						            const errorDiv = document.createElement('div');
						            errorDiv.className = 'text-danger small mt-1 validation-error-message';
						            errorDiv.textContent = message;
						            // Chèn sau parent của inputElement nếu inputElement là con trực tiếp,
						            // hoặc tìm một container phù hợp để chèn thông báo lỗi.
						            // Ví dụ đơn giản: chèn sau chính inputElement (cần CSS để định vị đúng)
						            inputElement.parentNode.insertBefore(errorDiv, inputElement.nextSibling);
						            inputElement.classList.add('is-invalid'); // Cho Bootstrap styling (nếu dùng)
						        }
						
						        function clearErrorMessages(formElement) {
						            const errorMessages = formElement.querySelectorAll('.validation-error-message');
						            errorMessages.forEach(function(msg) {
						                msg.remove();
						            });
						            const invalidInputs = formElement.querySelectorAll('.is-invalid');
						            invalidInputs.forEach(function(input) {
						                input.classList.remove('is-invalid');
						            });
						        }
						
						
						
						        // --- PHẦN SCRIPT CHO "LOAD MORE" SẼ VIẾT SAU ---
						        // const loadMoreButton = document.getElementById('load-more-reviews-btn');
						        // const reviewsContainer = document.getElementById('more-reviews-container');
						        // const noReviewsMessage = document.getElementById('no-reviews-message');
						
						        // if (loadMoreButton) {
						        //     loadMoreButton.addEventListener('click', function (event) {
						        //         event.preventDefault();
						        //         const movieId = this.dataset.movieId;
						        //         let nextPage = parseInt(this.dataset.nextPage);
						        //         const pageSize = parseInt(this.dataset.pageSize);
						
						        //         this.textContent = 'Loading...';
						        //         this.disabled = true;
						
						        //         fetch(`/movies/api/${movieId}/reviews?page=${nextPage}&size=${pageSize}`)
						        //             .then(response => {
						        //                 if (!response.ok) {
						        //                     throw new Error('Network response was not ok: ' + response.statusText);
						        //                 }
						        //                 return response.json();
						        //             })
						        //             .then(pageData => {
						        //                 if (pageData && pageData.content && pageData.content.length > 0) {
						        //                     pageData.content.forEach(review => {
						        //                         const reviewElement = createReviewElement(review); // Bạn cần tự viết hàm này
						        //                         reviewsContainer.appendChild(reviewElement);
						        //                     });
						        //                     nextPage++;
						        //                     this.dataset.nextPage = nextPage;
						        //                 }
						        //                 if (!pageData.last) {
						        //                     this.textContent = 'Load More';
						        //                     this.disabled = false;
						        //                 } else {
						        //                     this.textContent = 'No More Reviews';
						        //                     this.style.display = 'none';
						        //                 }
						        //             })
						        //             .catch(error => {
						        //                 console.error('Error fetching more reviews:', error);
						        //                 this.textContent = 'Error - Retry';
						        //                 this.disabled = false;
						        //             });
						        //     });
						        // }
						
						        // function createReviewElement(review) {
						        //     // Hàm này sẽ tạo HTML cho một review item, bạn cần tự định nghĩa dựa trên cấu trúc HTML của bạn
						        //     // Ví dụ:
						        //     // const div = document.createElement('div');
						        //     // div.className = 'movie-review-item';
						        //     // div.innerHTML = `... HTML của review ...`;
						        //     // return div;
						        //     console.warn("createReviewElement function needs to be implemented!");
						        //     return document.createElement('div'); // Placeholder
						        // }
						        // --- KẾT THÚC PHẦN LOAD MORE ---
						
						    });
						    	/*]]>*/
						</script>
								

</body>
</html>